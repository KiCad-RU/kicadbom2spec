// asciidoctor
:doctype: book
:toc2: left
:figure-caption!:
:toc-title: Содержание
:note-caption: Примечание
:warning-caption: Важно!
:last-update-label: Редакция от
:toclevels: 4
:sectnumlevels: 4
:imagesdir: images

:version: 3.10


= kicadbom2spec
:author: Барановский Константин
:email: baranovskiykonstantin@gmail.com

Руководство пользователя

Версия {version}


== Введение

**kicadbom2spec** -- приложение для создания перечней элементов схем,
выполненных в **KiCad**.

Перечни создаются в виде таблиц __*.ods__ в формате __Open Document Format__ и
оформляются в соответствии с требованиями __ЕСКД__.

Кроме создания перечня элементов, с помощью этой программы можно редактировать
необходимые пользовательские поля элементов как в файлах схем (__*.sch__) так
и в файлах библиотек (__*.lib__).

В данном руководстве представлена вся необходимая информация для успешного
создания перечней элементов и редактирования необходимых полей компонентов
схемы/библиотеки.

Все изображения были созданы в операционной системе Ubuntu, но в других ОС
интерфейс пользователя выглядит аналогично. В некоторых случаях, все же,
присутствуют различия и в таких местах приводятся изображения для каждого
конкретного случая.


== Быстрый старт

Для демонстрации работы программы **kicadbom2spec** в её директории имеется
каталог __sample__, в котором находятся файлы небольшой схемы:

[[содержимое_папки_sample]]
.Содержимое папки sample
image::содержимое_папки_sample.png[]

* __sample.lib__ -- библиотека элементов схемы
* __sample.pdf__ -- образец готового перечня элементов
* __sample.pro__ -- файл проекта KiCad
* __sample.sch__ -- файл схемы (поля элементов уже заполнены в соответствии с
данным руководством)

Итак, чтобы создать перечень элементов для схемы __sample.sch__ нужно запустить
**kicadbom2spec**, выполнить команду __Файл->Открыть схему...__ и выбрать файл
примера схемы. По умолчанию, он находится по следующему пути:

Linux:: `/usr/share/kicadbom2spec/sample/sample.sch`
Windows:: `C:\Program Files\kicadbom2spec\sample\sample.sch`

После этого в таблицу **kicadbom2spec** будут загружены элементы и станет
доступной команда __Файл->Создать перечень элементов...__ (и соответствующая
кнопка на панели инструментов):

.Окно программы kicadbom2spec с загруженными элементами из sample.sch
image::внешний_вид.png[]

На данном этапе можно выполнить редактирование полей элементов и сохранить
изменения в файл схемы. Но в этом примере ничего редактировать не нужно, сразу
переходим к созданию перечня. Нужно выполнить команду __Файл->Создать
перечень элементов...__ -- откроется диалог создания перечня элементов:

.Диалог создания перечня элементов
image::диалог_создания_перечня_для_примера.png[]

По умолчанию, файл перечня элементов предлагается расположить в каталоге со
схемой. Но, так как файлы примера установлены вместе с программой в системный
каталог, то у некоторых пользователей может быть недостаточно прав для записи в
него. Поэтому нужно изменить место сохранения перечня. Для этого необходимо
нажать кнопку справа от текстового поля -- откроется диалог выбора файла.
Теперь нужно указать каталог, к которому пользователь может легко получить
доступ, например -- __"Рабочий стол"__. Имя файла перечня элементов остается без
изменений -- __"sample.ods"__.

Из параметров нужно оставить отметку только для параметра __Добавлять единицы
измерения__ и завершить создание перечня нажав кнопку __Ок__. После завершения
генерации перечня элементов будет показано сообщение:

.Сообщение о создании перечня элементов
image::сообщение_о_создании_перечня_элементов.png[]

И в указанном ранее каталоге (на __Рабочем столе__) появится новый файл
__sample.ods__:

.Созданный файл перечня элементов
image::созданный_файл_перечня_элементов.png[]

Готово -- перечень элементов создан. Чтобы убедится что все выполнено верно,
можно сравнить полученный перечень с образцом __sample.pdf__.


:sectnums:


== Графический интерфейс пользователя

Внешний вид приложения **kicadbom2spec** показан на рисунке ниже.

[[внешний_вид]]
.Внешний вид
image::внешний_вид.png[]

Графический интерфейс пользователя имеет следующие основные элементы:

* **меню**;
* **панель инструментов**;
* **таблицу полей элементов**.

Рассмотрим дальше каждый из этих элементов отдельно.


=== Меню

Меню располагается в верхней части окна и содержит следующие элементы:

[[меню_программы]]
.Меню программы
image::меню_программы.png[]

* **Файл** -- в этом меню собраны команды, которые относятся к работе с файлами.
* **Правка** -- здесь собраны команды для редактирования полей элементов и
настроек программы.
* **Вид** -- содержит элементы настройки внешнего вида программы.
* **Справка** -- в этом меню доступны команды для получения справки.


==== Файл

В этом меню содержатся следующие команды для управления файлами:

* **Открыть схему...** -- открывает диалог для выбора файла схемы.
* **Недавние схемы** -- содержит список 10-и последних файлов схем.
* **Сохранить схему** -- сохраняет изменения полей элементов в файл схемы.
* **Сохранить схему как...** -- открывает диалог для сохранения схемы с
изменёнными полями элементов в новый файл.
* **Открыть библиотеку...** -- открывает диалог для выбора файла библиотеки
элементов.
* **Недавние библиотеки** -- содержит список 10-и последних файлов библиотек.
* **Сохранить библиотеку** -- сохраняет изменения полей элементов в файл
библиотеки.
* **Сохранить библиотеку как...** -- открывает диалог для сохранения библиотеки
с измененными полями элементов в новый файл.
* **Создать перечень элементов...** -- открывает диалог создания перечня
элементов.

[[диалог_создания_перечня_элементов]]
.Диалог создания перечня элементов
image::диалог_создания_перечня_элементов.png[]

В данном окне нужно указать имя файла для перечня элементов и задать некоторые
параметры.

* **Выход** -- завершит выполнение программы, если имеются не сохранённые
изменения{nbsp}-- будет показано предупреждающее сообщение.


==== Правка

В этом меню содержатся следующие команды редактирования полей элементов:

* **Отменить** -- отменяет последнее изменение поля/полей элементов.
* **Повторить** -- повторяет отменённое ранее изменение.

NOTE: Все изменения сохраняются в оперативной памяти и количество сохраняемых
изменений не ограничивается. При длительной работе с большим количеством
элементов может использоваться значительный объем памяти и если это критично,
то для её освобождения нужно сохранить схему/библиотеку и открыть её вновь.

* **Копировать** -- копирует значения всех пользовательских полей выбранного
элемента в буфер обмена.
* **Вырезать...** -- вырезает в буфер обмена значения полей элемента, которые
были указаны в диалоге выбора полей. Значения полей, которые не были отмечены,
просто копируются (без дальнейшего удаления).

[[диалог_выбора_полей]]
.Диалог выбора полей
image::диалог_выбора_полей.png[]

NOTE: Команды **Копировать** и **Вырезать...** применяются только к одному
элементу. Если при выполнении одной из этих команд будет выделено несколько
элементов{nbsp}-- отобразится предупреждающее сообщение с предложением
применить операция только к первому выделенному элементу.

* **Вставить...** -- вставляет в выделенный(е) элемент(ы) значения из буфера
обмена. Поля, значения которых нужно заменить, выбираются с помощью диалога
выбора полей. Не отмеченные поля останутся без изменений.

NOTE: Для организации __копирования__, __вырезания__ и __вставки__ полей
элементов в программе реализован свой собственный буфер обмена.

* **Найти...** -- открывает диалог поиска текста в полях элементов.

[[диалог_поиска_текста]]
.Диалог поиска текста
image::диалог_поиска_текста.png[]

* **Заменить...** -- открывает диалог замены текста в полях элементов.

[[диалог_замены_текста]]
.Диалог замены текста
image::диалог_замены_текста.png[]

* **Редактировать поля...** -- открывает редактор полей для выделенного(ых)
элемента(ов).

[[редактор_полей]]
.Редактор полей
image::редактор_полей.png[]

* **Очистить поля...** -- удаляет во всех выбранных элементах содержимое полей,
указанных в диалоге выбора полей.
* **Параметры...** -- открывает редактор настроек.
* **Импорт параметров...** -- открывает диалог выбора файла, в который нужно
сохранить текущие параметры программы.
* **Экспорт параметров...** -- открывает диалог выбора файла, из которого
нужно загрузить параметры программы.


==== Вид

Меню вид содержит лишь один пункт:

* **Панель инструментов** -- с помощью этой команды можно скрыть или отобразить
панель инструментов.


==== Справка

С помощью меню справки можно выполнить два действия:

* **Руководство пользователя** -- открывает данное справочное руководство.
* **О программе...** -- открывает диалоговое окно с краткими сведениями о
программе **kicadbom2spec**.


=== Панель инструментов

Панель инструментов расположена в верхней части окна и повторяет часто
используемые команды меню.

[[панель_инструментов]]
.Панель инструментов
image::панель_инструментов.png[]

Здесь доступны следующие команды (в порядке расположения слева направо):

* **Открыть схему**
* **Сохранить схему**
* **Создать перечень элементов**
* **Копировать**
* **Вырезать**
* **Вставить**
* **Отменить**
* **Повторить**
* **Редактировать поля**
* **Очистить поля**
* **Найти**
* **Заменить**
* **Руководство пользователя.**

В случае необходимости панель инструментов можно скрыть выбрав команду меню
__Вид->Панель инструментов__.


=== Таблица полей элементов

Таблица полей элементов занимает основную часть окна приложения и имеет
следующую структуру.

[[таблица_полей_элементов]]
.Таблица полей элементов
image::таблица_полей_элементов.png[]

Каждая строка представляет собой элемент схемы или библиотеки, а столбцы --
поля элементов. Всего столбцов девять:

* **Первый** столбец не имеет названия и содержит во всех ячейках флажки. С
помощью этих флажков можно выбирать элементы, которые нужно использовать при
создании перечня элементов. По умолчанию, все элементы отмечены флажками. При
редактировании файла библиотеки этот столбец хоть и отображается, но не
используется.
* **Второй** столбец __Группа__ содержит текст одноимённого поля элемента.
* **Третий** столбец __Обозначение__ содержит текст одноимённого поля элемента.
Это поле используется как уникальный идентификатор элемента и доступно только
для чтения. Нормально заполненная схема не должна иметь элементов с одинаковыми
__обозначениями__. Если в схеме есть не пронумерованные элементы (обозначение
пустое или оканчивается вопросительным знаком, например, __R?__, __C?__ и
т.д.), то они не будут загружены в таблицу.
* **Четвёртый -- девятый** столбцы отображают содержимое полей __Марка__,
__Значение__, __Класс точности__, __Тип__, __Стандарт__, __Примечание__,
соответственно.

При редактировании библиотеки элементов, ячейки столбца __Значение__ доступны
только для чтения, изменять значение этого поля в элементах библиотеки нельзя.


==== Контекстное меню таблицы

Контекстное меню вызывается щелчком правой кнопки мыши или нажатием специальной
клавиши на клавиатуре (между правыми __Alt__ и __Ctrl__).

[[контекстное_меню_таблицы]]
.Контекстное меню таблицы полей элементов
image::контекстное_меню_таблицы.png[]

Здесь собраны команды, которые непосредственно относятся к редактированию полей
элементов.


==== Редактор ячеек таблицы

Изменение содержимого отдельной ячейки таблицы выполняется с помощью
специального элемента графического интерфейса -- __текстового поля с выпадающим
списком__.

[[редактор_ячеек]]
.Редактор ячейки таблицы
image::редактор_ячеек.png[]

Новое значение вводится непосредственно в текстовое поле или выбирается из
списка доступных значений. Выпадающий список вызывается нажатием кнопки со
стрелкой справа от текстового поля. В нем содержатся стандартные значения для
данного поля, а также значения из других компонентов.


===== Контекстное меню редактора ячеек

Контекстное меню редактора ячеек содержит следующие команды:

[[контекстное_меню_редактора_ячеек]]
.Контекстное меню редактора ячеек
image::контекстное_меню_редактора_ячеек.png[]

* **Копировать** -- копировать выделенный текст.
* **Вырезать** -- вырезать выделенный текст.
* **Вставить** -- вставить текст из буфера обмена вместо выделенного текста.

NOTE: Операции __копировать__, __вырезать__ и __вставить__ оперируют с
системным буфером обмена.

* **Удалить** -- удалить выделенный текст.
* **Выделить всё** -- выделить содержимое текстового поля.
* **Добавить "..." в стандартные** -- добавить текущее значение в список
стандартных (этот пункт появляется если значение ещё отсутствует в стандартных
для данного поля).
* **Удалить "..." из стандартных** -- удалить текущее значение из списка
стандартных (этот пункт появляется если значение уже присутствует в стандартных
для данного поля).
* **Вставить подстановку...** -- содержит подменю с командами вставки шаблонов
подстановки других полей.


== Работа с программой

Работать с приложением **kicadbom2spec** довольно просто, но для полного
понимания процесса формирования перечня элементов из файла схемы **KiCad**
нужно объяснить некоторые определения и условности.

=== Основные принципы

Компоненты из схем, выполненных в **KiCad**, имеют всего четыре стандартных
поля:

* __Обозначение__
* __Значение__
* __Посад.место__
* __Документация__

Этого не достаточно для создания полноценного перечня элементов. Но **KiCad**
позволяет каждому элементу добавлять пользовательские поля и, благодаря этому,
становится возможным задать недостающую информацию для всех элементов.

Внесение недостающей информации для каждого компонента непосредственно в
редакторе схем **Eeschema** -- процесс довольно долгий, особенно, когда проект
достаточно крупный. Решить эту проблему позволяет **kicadbom2spec**. С его
помощью можно быстро и просто заполнить все необходимые поля и сформировать
перечень элементов.

Для каждого компонента схемы/библиотеки **kicadbom2spec** использует следующий
набор полей:

[[набор_полей]]
. __Группа__
. **Обозначение**
. __Марка__
. **Значение**
. __Класс точность__
. __Тип__
. __Стандарт__
. __Примечание__

NOTE: __Курсивом__ выделены пользовательские поля, а **жирным** -- стандартные.

Элементы, имеющие одинаковые значения поля __Группа__, будут объединены в одну
группу с указанным названием.

Значение поля **Обозначение** помещается в графу __Поз. обозначение__.

Из полей 3...7 формируется наименование элемента.

Значение поля __Примечание__ помещается в одноимённую графу перечня.

Рассмотрим пример образования одной строки перечня элементов:

image::пример.png[]

[cols="2"]
|===
^h|ЗНАЧЕНИЕ В ПЕРЕЧНЕ:
^h|ПОЛЕ ЭЛЕМЕНТА:

|Резисторы
|Группа

|R1
|Обозначение

|МЛТ-0,25-
|Марка

|1,8к
|Значение^1^

|±5%
|Класс точности

|-В
|Тип

|{nbsp}ОЖ0.467.18
|Стандарт^2^

|1...2,8кОм
|Примечание
|===

|===
a|
__Примечания:__

. Единицы измерения (в данном случае "Ом") могут добавляться автоматически
для резисторов, конденсаторов и индуктивностей если при создании перечня
элементов была установлена отметка возле параметра __Добавлять единицы
измерения__.
. Стандарт указан с пробелом в начале.
|===

При образовании наименования разделители не используются, поэтому их нужно
указывать в значениях полей.

Если какое-нибудь поле не нужно -- его оставляют пустым.

Количество элементов подсчитывается автоматически. Если имеется несколько
одинаковых элементов идущих подряд, они сводятся в одну строку с указанием
первого и последнего элемента и их общего количества.


=== Работа с таблицей полей элементов


==== Сортировка элементов

Для представления элементов в более удобном виде предусмотрена возможность
сортировки содержимого таблицы. Выполняется она путём нажатия левой кнопки
мыши на заголовке столбца, по содержимому которого должна производится
сортировка. Например, если нужно отобразить элементы собранные по группам и в
алфавитном порядке -- нужно нажать на заголовок столбца __Группа__. Если нажать
ещё один раз -- содержимое отсортируется в обратном порядке.

[[индикатор_сортировки]]
.Индикатор сортировки
image::индикатор_сортировки.png[]

В заголовке столбца, по которому выполнена сортировка, появляется индикатор с
указанием направления сортировки.


==== Выделение элементов

Чтобы выделить один элемент нужно нажать левой кнопкой мыши (ЛКМ) на одном из
его полей.

Если необходимо выделить несколько элементов подряд -- нужно выделить первый
нужный элемент, затем нажать клавишу __Shift__ и не отпуская её нажать ЛКМ на
последнем нужном элементе. Эту же операцию можно выполнить другим
способом{nbsp}-- нажать ЛКМ на первом нужном элементе и не отпуская её тянуть
курсор к последнему нужному элементу и после этого отпустить ЛКМ.

Чтобы выделить несколько не последовательных элементов нужно выделить первый
элемент, а последующие выделять при нажатой клавише __Ctrl__.


==== Поиск/замена текста

Чтобы найти текст в полях элементов нужно воспользоваться командной
__Правка->Найти...__ После выбора данной команды будет открыт
<<диалог_поиска_текста, диалог поиска текста>> в котором нужно ввести фрагмент
текста в текстовое поле и для поиска ниже выделенного элемента, нажать кнопку
__Далее__ или нажать клавишу __Enter__. Для поиска текста в обратном
направлении нужно нажать кнопку __Назад__.

Чтобы уточнить результаты поиска можно воспользоваться опциями:

* **С учётом регистра** – поиск будет выполнен учитывая регистр введённых букв;
* **Слово целиком** – будут найдены только те слова, которые полностью
соответствуют введённому поисковому запросу.

WARNING: Если включена опция **Слово целиком** и запрос состоит из нескольких
слов, то они никогда не будут найдены (если нужно найти слово, то и запрос
должен быть словом).

Для замены текста используется команда __Правка->Заменить...__ При её выборе
появится расширенное диалоговое окно поиска -- <<диалог_замены_текста, диалог
замены текста>>. В начале выполняется поиск фрагмента текста, который нужно
заменить подобно тому как было описано ранее. Далее вводится текст на который
нужно заменить найденный фрагмент в поле __Заменить на__ и нажатием кнопки
__Заменить__ выполняется замена.


==== Редактирование полей

Любое изменение в таблице можно отменить с помощью команды меню
__Правка->Отменить__, а отменённое действие повторить с помощью команды
__Правка->Повторить__. Если после отмены было произведено новое изменение то
команда повтора становится недоступной.

Для редактирования содержимого полей предусмотрено несколько способов.

Прежде всего, каждое доступное для редактирования поле можно править щёлкнув по
нему двойным щелчком ЛКМ. В случае с флажками -- однократный щелчок ЛКМ изменит
его состояние на противоположное. Эти же операции можно выполнять с клавиатуры.
С помощью стрелок нужно переместиться к ячейке с содержимым поля, которое
необходимо отредактировать и для замены - просто начать вводить новое значение,
для редактирования -- нажать клавишу __F2__. Для изменения состояния флажка
нужно нажать клавишу __пробел__.

Изменение содержимого ячеек выполняется с помощью <<редактор_ячеек, редактора
ячеек>>. При его активации, выпадающий список заполняется следующим образом.
Сначала в него добавляются стандартные значения (если они имеются) и, затем,
все уникальные значения этого же поля других компонентов.

Чтобы добавить новое значение в список стандартных для текущего поля, можно
воспользоваться <<контекстное_меню_редактора_ячеек, контекстным меню>>.
Аналогичным образом текущее значение можно удалить из стандартных, если оно там
уже присутствует.


==== Редактирование полей нескольких элементов одновременно

Для редактирования полей нескольких элементов одновременно можно
воспользоваться <<редактор_полей, редактором полей>>. Чтобы изменить
значения полей одновременно для нескольких элементов необходимо их выделить и
затем выполнить команду __Правка->Редактировать поля...__, откроется редактор
полей. Он содержит флажок для указания того, нужно ли помещать выделенные
элементы в перечень элементов или нет (при редактировании библиотеки{nbsp}--
отсутствует) и текстовые поля с выпадающим списком (аналог редактора ячеек) для
редактирования полей элементов. В отличии от редактора ячеек, в редакторе полей
значения для каждого поля собираются не со всех компонентов, а только с
выделенных.

По умолчанию, во всех текстовых полях редактора полей установлено значение
__<не изменять>__, что указывает на то, что значение полей не будет изменено.
Это позволяет редактировать только нужные поля, а остальные оставить без
изменений. Чтобы изменить значение поля всех выделенных элементов нужно
заменить надпись __<не изменять>__ на нужное значение и нажать кнопку __Ок__.

Значения полей одного или нескольких элементов можно очищать. Для этого
существует команда меню __Правка->Очистить поля...__, после выбора которой
отобразится <<диалог_выбора_полей, диалог выбора полей>>. Чтобы очистить нужные
поля{nbsp}-- их необходимо отметить и нажать кнопку __Ок__.

При редактировании полей доступны операции для работы с буфером обмена
__Правка->Копировать/Вырезать.../Вставить...__ Команды __Копировать__ и
__Вырезать...__ применимы только к одному элементу. Команду __Вставить...__
можно применять сразу к нескольким выделенным элементам.

При копировании, в буфер обмена сохраняются значения полей выделенного
элемента. При вырезании выполняется копирование значений всех полей с
последующей очисткой только тех полей, которые были указаны в диалоге выбора
полей. При вставке будут заменены значения только тех полей, которые были
отмечены в диалоге выбора полей.


==== Редактирование полей компонентов иерархических схем

С помощью **KiCad** можно создавать довольно сложные схемы, содержащие
множество иерархических листов неограниченной вложенности. Компоненты таких
схем собираются со всех листов, включая иерархические, в один список и
формируют единый перечень элементов.

Ещё одной особенностью САПР **KiCad**, при создании сложных схем, является
возможность использования одной и той же схемы для нескольких иерархических
листов. Таким образом можно изобразить некое количество повторяющихся
однотипных узлов. В данном случае компоненты иерархической схемы сохраняются
особым образом. Дело в том, что несколько однотипных листов ссылаются к одной и
той же схеме и, таким образом, эти однотипные листы используют одни и те же
компоненты. Эти компоненты содержат специальные свойства, в которых указаны
обозначения для каждого из листов, т.е. каждый из таких компонентов имеет
несколько обозначений. Изменение значения поля компонента в одном из однотипных
листов приведёт к изменению этого же поля, такого же компонента, в остальных
листах.

В **kicadbom2spec** такие компоненты отображаются особым образом. Компоненты
одного из повторяющихся однотипных листов принимаются за "оригинальные", а
компоненты остальных листов как "копии". Это разделение условно и сделано для
удобства редактирования.

"Оригинальные" компоненты отображаются в таблице с пометкой "*" в конце
обозначения. Если увидите компонент с данной пометкой, например, __R256*__,
значит где-то в таблице имеются его "копии".

"Копии" компонента в поле __Обозначение__ содержат обозначение "оригинального"
компонента в скобках. Например, __R123(R256)__.

Так как "оригинальные" компоненты и их "копии", по сути, являются одним
компонентом с одним набором полей, но с несколькими обозначениями, то значения
полей у них всегда равны. Поэтому редактировать можно только "оригинальные"
компоненты. После изменения поля "оригинального" компонента, соответствующее
поле "копий" примет такое же значение. "Копии" доступны лишь для чтения и
отображаются для предоставления полного перечня элементов.

Если в процессе редактирования дважды щёлкнуть мышей по "копии", отобразиться
информационное сообщение с предложением перейти к "оригинальному" компоненту.

При формировании перечня элементов будут использоваться обычные обозначения без
каких либо пометок (в данном случае без "__*__" и "__(256)__"). Они
используются только для удобства редактирования.


==== Подстановки полей

В процессе работы **kicadbom2spec** использует фиксированный набор полей. В то
же время, пользователь может хранить некоторую информацию в других
пользовательских полях или в стандартных полях, которые не используются в
**kicadbom2spec** (__Посад.место__, __Документация__). Для того чтобы включить
эти данные в перечень элементов используются __подстановки полей__.

Принцип работы следующий. В полях, <<набор_полей, с которыми работает
**kicadbom2spec**>>, вставляются специальные метки:

`${Название_поля}`

При формировании перечня элементов **kicadbom2spec** обрабатывает каждый
элемент и когда находит подобную метку -- ищет в этом же компоненте поле с
названием __**Название_поля**__. Далее, метка заменяется содержимым найденного
поля. Если поле с указанным именем не найдено, метка просто удаляется.

Подобные метки можно вводить вручную с клавиатуры или воспользоваться
контекстным меню в <<редактор_ячеек, редакторе ячеек>>. В нём всегда
присутствуют подстановки четырех стандартных полей. Чтобы вставить подстановку
пользовательского поля, можно выбрать __Вставить подстановку...->Другую...__.
При этом в текстовое поле будет вставлена пустая метка с курсором внутри скобок
для ввода названия нужного поля.

Метки могут быть окружены текстом, т.е. помимо меток в поле можно указывать и
другую информацию. Также, в поле можно вставлять несколько меток.

Для примера предположим, что в перечне элементов компоненту схемы нужно указать
тип корпуса. Используем для этого поле __Примечание__ и заполняем его следующим
образом:

`В корпусе ${Посад.место}`

Компоненту присвоено посадочное место, скажем, __DIP16__. Тогда в перечне
элементов, в поле __Примечание__ получим:

`В корпусе DIP16`


=== Создание перечня элементов

Когда в **kicadbom2spec** загружен файл схемы и все необходимые поля
заполнены{nbsp}-- можно приступить к созданию перечня элементов. Для этого
нужно выполнить команду __Файл->Создать перечень элементов...__. Откроется
<<диалог_создания_перечня_элементов, диалог создания перечня элементов>>, в
котором нужно указать имя файла перечня элементов. По умолчанию, это имя
образуется из имени файла схемы путём замены расширения на __*.ods__.  Если же
данный вариант не устраивает можно исправить имя в текстовом поле или с помощью
диалога выбора файлов нажав кнопку справа от текстового поля.

Дополнительно доступны следующие параметры:

* __Добавить единицы измерения__ -- если этот параметр отмечен и в значениях
резисторов/конденсаторов/индуктивностей (определяется по литерам обозначения
__R__, __C__, __L__) отсутствуют единицы измерения (например, __10к__, __1мк__,
__2.2н__), то они будут добавлены автоматически (__10кОм__, __1мкФ__,
__2.2нГн__).
* __Все элементы__ -- если этот параметр отмечен, то перечень будет составлен
из всех элементов схемы, т.е. состояние флажка в таблице будет проигнорировано.
* __Добавить лист регистрации изменений__ -- если данная опция включена, то в
конец перечня элементов будет добавлен лист регистрации изменений.
* __Открыть перечень элементов__ -- если этот параметр установлен, то по
завершении будет открыт созданный перечень элементов в редакторе по умолчанию
(например, в **LibreOffice**).

Когда все параметры заданы, можно завершить создание перечня нажав кнопку
__Ок__. После успешного завершения генерации перечня элементов будет показано
сообщение:

[[сообщение_о_создании_перечня_элементов]]
.Сообщение о создании перечня элементов
image::сообщение_о_создании_перечня_элементов.png[]

Если перед созданием перечня был установлен параметр __Открыть перечень
элементов__, то сообщение о завершении показано не будет, вместо него будет
открыт созданный перечень элементов.

NOTE: При создании перечня элементов из **Eeschema** в директории фала схемы
автоматически создаются два новых файла: один с названием схемы и
расширением __*.xml__, второй тоже с названием схемы, но без расширения. Они не
используются программой **kicadbom2spec** и если в них нет необходимости, могут
быть удалены.


== Настройка программы

Редактор настроек вызывается из меню с помощью команды
__Правка->Параметры...__.

[[редактор_настроек]]
.Внешний вид редактора настроек
image::редактор_настроек.png[]

Все настройки разбиты на группы, каждая из которых расположена на отдельной
вкладке.


=== Основные параметры

Эти параметры относятся к программе в целом. Рассмотрим каждый из параметров в
отдельности.

**Сохранять положение и размер окна** -- если этот параметр установлен, то при
завершении работы программы будет сохранено положение окна и его размер, а при
следующем запуске эти значения будут восстановлены. Если же параметр не
установлен, то программа будет каждый раз запускаться с размером и положением
на экране заданным по умолчанию.

**Сохранять ширину колонок таблицы** -- если этот параметр установлен, то в
процессе работы и при завершении программы ширина столбцов таблицы элементов
будет сохранятся и при следующем запуске они будут восстановлены.

**Запоминать выбор элементов** -- если это параметр установлен, то при
сохранении файла схемы для элементов, которые исключены из перечня элементов
(отметка в таблице снята) будет добавлено новое поле с именем "Исключён из
ПЭ". В этом поле можно указать комментарий с описанием причины, по которой
элемент был исключён из перечня (только в **Eeschema**). При открытии файла
схемы у элементов которые содержат поле "Исключён из ПЭ" будет автоматически
снята отметка и при создании перечня эти элементы в перечень не попадут. +
В общей сложности этот параметр позволяет сохранять состояние выбора элементов
в файле схемы.

**Автоматически заполнять поле "Группа"** -- данный параметр позволяет
несколько автоматизировать процесс оформления перечня элементов. А именно, для
заданных типов элементов автоматически заполнять поле "Группа" при загрузке
документа.

NOTE: автоматическое заполнение применяется только к элементам с пустым полем
"Группа".

Для организации пар __тип элемента -- значение поля "Группа" __ предусмотрен
специальный редактор, в котором доступны три действия __Добавить__,
__Изменить__ и __Удалить__. Существующие элементы отображаются в списке и
могут включаться или отключаться с помощью отметок.

Чтобы добавить новый элемент нужно нажать на кнопку __Добавить__ после чего
отобразится диалоговое окно, как показано на рисунке:

[[диалог_создания_элемента_списка]]
.Диалог создания элемента списка
image::диалог_создания_элемента_списка.png[]

В этом диалоге нужно заполнить два поля.

Первое из них __Обозначение элемента__ -- это один или два символа, с которых
начинается обозначение элемента, и по которым можно определить принадлежность
элемента к группе. Например, "С" для конденсаторов, "R" для резисторов, "VT"
для транзисторов, "D" для аналоговых и цифровых микросхем (если нужно
конкретизировать можно указать "DA" для, скажем, стабилизаторов или
операционных усилителей) и т.д.

Второе -- __Значение поля "Группа" __ — здесь нужно задать значение поля
"Группа", которое будет автоматически присваиваться элементам, обозначение
которых начинается с символов, указанных в предыдущем поле.

Если нужно отредактировать уже существующий элемент, необходимо его выделить и
нажать кнопку __Изменить__ или произвести двойной щелчок ЛКМ по элементу
списка. В результате откроется диалоговое окно, подобное диалогу создания
элемента.

[[диалог_редактирования_элемента_списка]]
.Диалог редактирования элемента списка
image::диалог_редактирования_элемента_списка.png[]

Для сохранения выполненных изменений нужно нажать кнопку __Ок__, для отмены --
__Отмена__.

Чтобы удалить элемент из списка, нужно выделить его и нажать кнопку
__Удалить__.


=== Значения полей

При оформлении перечня элементов, заполняя поля элементов часто приходится
использовать стандартные значения, такие, например, как "Резисторы",
"Конденсаторы", "Диоды" и т.д. для поля "Группа" или "±1%", "±5%", "±10%" для
поля "Класс точности".

[[редактор_стандартных_значений_для_полей]]
.Редактор стандартных значений для полей
image::редактор_стандартных_значений_для_полей.png[]

Чтобы ускорить процесс заполнения перечня предусмотрена возможность задавать
стандартные значения для определённых полей элементов. Делается это с помощью
вкладки __Значения полей__ редактора настроек.

Для каждой группы можно задать несколько значений, каждое из которых
расположено на отдельной строке.

Теперь при редактировании элементов все эти варианты значений будут доступны в
выпадающем списке.


=== Импорт/экспорт параметров

Выполнить перенос параметров из одной копии программы в другую можно следующим
образом.

В первой копии программы необходимо выбрать пункт меню __Правка->Экспорт
параметров...__ и в диалоге сохранения файлов указать в какой файл нужно
сохранить текущие настройки. По умолчанию, имя файла -- `settings.ini`, его
можно изменить по своему усмотрению.

Далее нужно во второй программе выбрать пункт меню __Правка->Импорт
параметров...__ и в диалоге открытия файлов выбрать файл, полученный в
предыдущем шаге. После этого откроется диалоговое окно в котором будет
предложено выбрать параметры для импорта.

[[диалог_выбора_параметров_для_импорта]]
.Диалог выбора параметров для импорта
image::диалог_выбора_параметров_для_импорта.png[]

Для завершения импорта параметров нужно нажать кнопку __ОК__. Выбранные
параметры сразу же будут применены к программе.


== Параметры командной строки

При запуске программы **kicadbom2spec**, ей можно передавать один или два
позиционных аргумента. Это даёт возможность подключать **kicadbom2spec** к
редактору схем **Eeschema** в качестве плагина.

.Формат вызова программы из командной строки:
`python kicadbom2spec.pyw [-h] [-v] [schematic] [complist]`


=== Первый позиционный аргумент __**schematic**__

С помощью этого параметра в программу передаётся имя файла схемы в формате
__KiCad Schematic__.

Так как при запуске **kicadbom2spec** в качестве плагина **Eeschema**, ей
передаётся в первом параметре имя файла списка цепей (__*.xml__), то для
обеспечения правильной работы применяется следующий процесс обработки
параметра:

* считывается имя файла;
* удаляется расширение;
* добавляется расширение __*.sch__;
* проверяется наличие файла с полученным именем:
** если файл существует -- его содержимое загружается для дальнейшего
редактирования;
** если файл не существует -- открывается диалог выбора файла схемы вручную.


=== Второй позиционный аргумент __**complist**__

С помощью этого параметра в программу передаётся имя файла в который будет
сохранен перечень элементов. Расширение файла автоматически заменяется на
__*.ods__.


=== Параметр __**-h, --help**__

С этим параметром программа выводит справочное сообщение с краткой информацией
о программе и доступных параметрах. Затем закрывается без выполнения каких-либо
вычислений.


=== Параметр __**-v, --version**__

С этим параметром программа выводит номер текущей версии программы и
закрывается без выполнения каких-либо вычислений.


== Настройка __**KiCad**__ для работы с __**kicadbom2spec**__

Возможности программы **Eeschema** позволяют использовать сторонние инструменты
для создания перечней элементов. Как использовать в данном случае
**kicadbom2spec** будет рассказано далее.


=== Настройка редактора схем __**Eeschema**__

Прежде всего можно определить несколько пользовательских полей для элементов
схемы. Для этого нужно открыть диалог настроек, выбрав в меню
__Настройки->Параметры__ и во вкладке __Шаблон имён полей__ заполнить поля как
показано на рисунке ниже. Порядок полей не имеет значения.

[[настройки_пользовательских_полей]]
.Настройка пользовательских полей
image::настройки_пользовательских_полей.png[]

Благодаря данным шаблонам, при открытии редактора свойств элемента, в нем уже
будут присутствовать указанные выше поля. Иначе, пришлось бы добавлять их
каждому элементу отдельно.

NOTE: Данная настройка не является обязательной. Она лишь упрощает работу с
полями в редакторе схем **Eeschema**. **kicadbom2spec** сам создаст все
необходимые поля, если будет необходимо.


==== Создание и настройка плагина

Следующим этапом является создание нового инструмента генерации перечня
элементов (плагина). Для этого в **Eeschema** нужно выполнить команду
__Инструменты->Сформировать перечень элементов__ или нажать соответствующую
кнопку на панели инструментов, после чего откроется диалог:

[[диалог_создания_перечня_элементов_в_eeschema]]
.Диалог создания перечня элементов в Eeschema
image::диалог_создания_перечня_элементов_в_eeschema.png[]

Чтобы добавить новый инструмент генерации перечня элементов нужно нажать кнопку
__Добавить плагин__. Откроется диалог выбора файлов в котором необходимо
указать файл программы. По умолчанию, **kicadbom2spec** находится по следующему
пути:

Linux:: `/usr/share/kicadbom2spec/kicadbom2spec.pyw`
Windows:: `C:\Program Files\kicadbom2spec\kicadbom2spec.pyw`

Нужно выбрать его. После этого откроется диалоговое окно, в котором будет
предложено ввести имя плагина (по умолчанию, "kicadbom2spec" -- формируется
автоматически на основе имени файла плагина) и подтвердить создание нажатием
кнопки __Ок__.

[[запрос_имени_плагина]]
.Запрос имени плагина
image::запрос_имени_плагина.png[]

Теперь, когда плагин создан, в диалоговом окне отобразится новый элемент с
указанным ранее названием. Поле __Команда__ **KiCad** заполнит автоматически.

[[диалог_создания_перечня_элементов_после_добавления_плагина]]
.Диалог создания перечня элементов полсе добавления плагина
image::диалог_создания_перечня_элементов_после_добавления_плагина.png[]

**В операционных системах на базе Linux** могут быть установлены обе версии
__Python2__ и __Python3__{nbsp}-- нужно указать конкретную версию __Python__,
как показано на рисунке ниже.

[[диалог_создания_перечня_элементов_с_указанной_версией_python]]
.Диалог создания перечня элементов с правильно настроенным плагином в Linux
image::диалог_создания_перечня_элементов_с_указанной_версией_python.png[]

**В операционных системах MS Windows** диалог создания перечня элементов
немного отличается. Там присутствует специальный параметр __Показать окно
консоли__.  Нужно установить отметку напротив этого параметра -- это очень
важно, **без него окно программы не будет отображаться!**

[[диалог_создания_перечня_элементов_с_правильно_настроенным_плагином]]
.Диалог создания перечня элементов с правильно настроенным плагином в Windows
image::диалог_создания_перечня_элементов_с_правильно_настроенным_плагином.png[]

После этого плагин готов к работе. Его можно запустить нажав кнопку
__Сформировать__.


